# 第5章 网络层：控制平面

控制平面作为一种网络范围的逻辑，不仅控制沿着从源主机到目的主机的端到端路径之间的路由器如何转发数据报，而且控制网络层组件和服务如何配置和管理。

## 5.1 概述

在本章中我们将学习转发表和流表是如何计算、维护和安装的。在4.1中我们已经学习了完成这些工作的两种可能方法。

* **每路由器控制**。每台路由器中运行一种路由选择算法。每台路由器有一个路由选择组件，用于与其它路由中的路由选择组件进行通信，以计算其转发表的值。
* **逻辑集中式控制**。逻辑集中式控制器计算并分发转发表以供每台路由器使用。

## 5.2 路由选择算法

可以将路由器看作是一张图上的节点，路由器之间存在可以互相通信的边，每条边根据其实际情况有着不同的开销。那么对于一个特定的发送而言，路由选择就是在图上找一条合适的路径，其中最优的选择就是图上的**最短路径**(shortest path)。

一般而言，路由选择算法的一种分类方式是根据算法是集中式还是分散式来划分。

* **集中式路由选择算法**(centralized routing algorithm)用完整的、全局的网络知识计算出从源到目的地之间的最低开销路径。这就是说在计算路径之前，该算法要求知道关于连通性和链路开销的完整信息。具有全局状态信息的算法常被称为**链路状态**(Link State, LS)**算法**。
* **分散式路由选择算法**(decentralized routing algorithm)中，路由器以迭代、分布式的计算方式计算出最低开销路径。没有节点拥有关于所有网络链路开销的完整信息。相反，每个节点仅有与其直接相连链路的开销信息即可开始工作。然后通过迭代计算过程以及与相邻节点的信息交换，一个节点逐渐计算出到达目的节点的最低开销路径。我们之后会学习**距离向量**(Distance-Vector, DV)**算法**。此算法中每个节点维护到网络中其他节点的开销估计的向量。

路由选择算法的第二种广义分类方式是根据算法是静态的还是动态的进行分类。在**负载敏感算法**(load-sensitive algorithm)中，链路开销会动态地变化以反映出底层链路的当前拥塞水平，这种设计带了了许多难题。当今的因特网路由选择算法都是**负载迟钝的**(load-insensitive)，因为某条链路的开销不明确地反映其当前的拥塞水平。

### 5.2.1 链路状态路由选择算法

本节讲了一种LS算法，就是最短路中的Dijkstra算法，大家应该在数据结构中都学过了。

### 5.2.2 距离向量路由选择算法

每个单独的节点都维护如下信息：

* 对于每个邻居v，从x到直接相连邻居v的开销为c(x, v)。
* 节点x的距离向量，即$D_x = [D_x(y):y \in N]$是节点x的距离向量，该向量是从x到在N中的所有其他节点y的开销量。
* 它的每个邻居的距离向量，即对x的每个邻居v有，$D_v = [D_v(y):y \in N]$。

节点之间异步共享这些信息，然后用Bellman-Ford方程更新它自己的距离向量：

$$
D_x(y) = min_v \{ c(x, v) + D_v(y) \}
$$

如果节点x的距离向量因这个更新步骤而改变，节点x接下来将向它的每个邻居发送其更新后的距离向量，这继而让所有邻居更新它们自己的距离向量。

#### 1. 距离向量算法：链路开销改变与链路故障

当一个节点的开销变化时导致下事件序列的出现：

* 在$t_0$时刻，y检测到链路开销变化，更新其距离向量，并通知邻居，因为最低开销变化了。
* 在$t_1$时刻，z收到了来自y更新的报文，并更新了距离表，计算出了新的最低开销，并向邻居发送了它的距离向量。
* 在$t_2$时刻，y收到了来自z的更新。但因为y的最低开销没有改变，因此不发送任何报文。算法进入静止状态。

#### 2. 距离向量算法：增加毒性逆转

#### 3. LS与DV路由选择算法的比较

## 5.3 因特网中自治系统内部的路由选择：OSPF

## 5.4 ISP之间的路由选择：BGP

### 5.4.1 BGP的作用

### 5.4.2 通告BGP路由信息

### 5.4.3 确定最好的路由

#### 1. 热土豆路由选择

#### 2. 路由器选择算法

### 5.4.4 IP任播

### 5.4.5 路由选择策略

### 5.4.6 拼装在一起：在因特网中呈现

## 5.5 SDN控制平面

### 5.5.1 SDN控制平面：SDN控制器和SDN网络控制应用程序

### 5.5.2 OpenFlow 协议

### 5.5.3 数据平面和控制平面交互的例子

### 5.5.4 SDN的过去与未来

## 5.6 ICMP：因特网控制报文协议

## 5.7 网络管理和SNMP

### 5.7.1 网络管理框架

### 5.7.2 简单网络管理协议

## 5.8 小结
